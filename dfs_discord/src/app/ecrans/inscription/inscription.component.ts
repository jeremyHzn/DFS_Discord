import { Component, inject } from '@angular/core';
import {
  FormBuilder,
  FormGroup,
  FormsModule,
  ReactiveFormsModule,
  Validators,
} from '@angular/forms';
import { MatButtonModule } from '@angular/material/button';
import { MatInputModule } from '@angular/material/input';
import { RuleComponent } from '../../components/rule/rule.component';
import { HttpClient } from '@angular/common/http';
import { MatSnackBar } from '@angular/material/snack-bar';
import { Router } from '@angular/router';

@Component({
  selector: 'app-inscription',
  standalone: true,
  templateUrl: './inscription.component.html',
  styleUrl: './inscription.component.scss',
  imports: [
    MatInputModule,
    MatButtonModule,
    FormsModule,
    ReactiveFormsModule,
    RuleComponent,
  ],
})
export class InscriptionComponent {
  formBuilder: FormBuilder = inject(FormBuilder);
  http = inject(HttpClient);
  router: Router = inject(Router);
  snackBar: MatSnackBar = inject(MatSnackBar);

  formulaire: FormGroup = this.formBuilder.group({
    email: ['', [Validators.required, Validators.email]],
    password: [
      '',
      [
        Validators.required,
        Validators.pattern(/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d).+$/),
      ],
    ],
    confirmationPassword: ['', [Validators.required]],
    urlAvatar : ['']
  });

  passwordIdentique: boolean = true;

  verifierMotDePasseIdentique() {
    if (this.formulaire.get('confirmationPassword')?.dirty) {
      this.passwordIdentique =
        this.formulaire.get('password')?.value ==
        this.formulaire.get('confirmationPassword')?.value;
    }
  }

  onInscription() {
    if (this.formulaire.valid && this.passwordIdentique) {
      if(this.formulaire.get('urlAvatar')?.value == ''){
        this.formulaire.get('urlAvatar')?.setValue('data:image/jpeg;base64,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');
      }
      this.http
        .post('http://localhost:3000/inscription', this.formulaire.value)
        .subscribe((utilisateur) => {
          this.snackBar.open(
            'Vous êtes inscrit, vous pouvez vous connecter avec vos identifiants',
            undefined,
            {
              duration: 3000,
            }
          );

          this.router.navigateByUrl('/connexion');
        });
    }
  }
}
